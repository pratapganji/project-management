1. Overview

Purpose
This document describes the migration of the SB User Consumption application from a standalone on-prem Linux deployment to a Docker-based OpenShift Container Platform (OCP). The migration improves scalability, security compliance, observability, and operational consistency.

Scope
	‚Ä¢	Application Name: 176352.olympus-data.olympus-sb-user-consumption
	‚Ä¢	Repository: <internal GitHub link>
	‚Ä¢	Migration Type: On-prem ‚Üí OpenShift (OCP)
	‚Ä¢	Environments: Dev / QA / Prod

‚∏ª

1.1 Migration Drivers
	‚Ä¢	Legacy deployment tightly coupled to host machines
	‚Ä¢	Secrets managed via ICP/CPP on servers (not cloud compatible)
	‚Ä¢	No container standardization
	‚Ä¢	Limited scalability and monitoring
	‚Ä¢	Cloud migration mandate for Citi Digital workloads
2. Application Details
Item
Description
Application Type
Batch / Scheduled Python Job
Technology
Python
Python Version
3.8+
Runtime
Docker (UBI base image)
Deployment
OpenShift
Trigger
CronJob / Manual
Ports
N/A (non-HTTP workload)
3. Pre-Migration Architecture (Before OCP)

3.1 Deployment Model
	‚Ä¢	Application ran on on-prem Linux servers
	‚Ä¢	Python virtual environment (venv)
	‚Ä¢	Environment variables injected via shell scripts
	‚Ä¢	Database credentials handled via ICP-based encryption/decryption
	‚Ä¢	Logging written to local files

3.2 Limitations
	‚Ä¢	Host-dependent configuration
	‚Ä¢	Manual scaling
	‚Ä¢	No standardized secrets management
	‚Ä¢	No centralized monitoring

‚∏ª

4. Target Architecture (OCP)

4.1 OpenShift Components Used
	‚Ä¢	Namespace / Project
	‚Ä¢	Deployment / CronJob
	‚Ä¢	ConfigMap
	‚Ä¢	Secret (NGC / CyberArk)
	‚Ä¢	ImageStream
	‚Ä¢	BuildConfig / Tekton (if applicable)

4.2 Architecture Overview
	‚Ä¢	Application runs as containerized workload
	‚Ä¢	Secrets injected at runtime
	‚Ä¢	Logs streamed to stdout
	‚Ä¢	Resource usage controlled via quotas
	‚Ä¢	Fully cloud-compliant

‚∏ª

5. Containerization Details

5.1 Dockerfile Overview

Key design decisions:
	‚Ä¢	Base image: ubi8/python-38 (Citi approved)
	‚Ä¢	Non-root execution
	‚Ä¢	Minimal attack surface
	‚Ä¢	Dependencies installed via pip
FROM registry.access.redhat.com/ubi8/python-38
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
USER 1001
CMD ["python", "main.py"]
For Java: use ubi8/openjdk-17 and ENTRYPOINT ["java","-jar","app.jar"]
6. Configuration Management

6.1 Environment Variables
Variable
Source
ENV
Deployment YAML
DB_HOST
ConfigMap
DB_USER
Secret
DB_PASSWORD
Secret (NGC)
6.2 ConfigMaps
	‚Ä¢	Application configs
	‚Ä¢	Environment-specific parameters
	‚Ä¢	Non-sensitive values only

6.3 Secrets
	‚Ä¢	Managed via NGC / CyberArk
	‚Ä¢	Injected as env vars
	‚Ä¢	No secrets in code or images

‚∏ª

7. Deployment Process

7.1 Build & Deploy Steps
	1.	Build container image
	2.	Push to internal registry
	3.	Apply OpenShift manifests
	4.	Verify pod startup
	5.	Validate logs

7.2 Commands
oc apply -f deployment.yaml
oc rollout status deployment/sb-user-consumption
8. Application Startup & Runtime Behavior
	‚Ä¢	Entry point executed on pod startup
	‚Ä¢	Health checks (if applicable)
	‚Ä¢	Logs written to stdout/stderr
	‚Ä¢	No local file logging

‚∏ª

9. Networking & Access
	‚Ä¢	No external exposure
	‚Ä¢	Internal DB access via approved routes
	‚Ä¢	TLS handled at platform level

‚∏ª

10. Monitoring & Logging
	‚Ä¢	Logs available via oc logs
	‚Ä¢	Integrated with centralized logging
	‚Ä¢	Resource usage tracked via OCP metrics

‚∏ª

11. Security Considerations
	‚Ä¢	Non-root containers
	‚Ä¢	Image vulnerability scanning
	‚Ä¢	Secrets never stored in code
	‚Ä¢	RBAC-based access

‚∏ª

12. Rollback Strategy
	‚Ä¢	Roll back by redeploying previous image tag
oc rollout undo deployment/sb-user-consumption
13. Issues Faced & Resolutions
Issue
Resolution
Env vars not visible
Used envFrom
Logs not visible
Switched to stdout
Secrets not accessible
Corrected NGC secret mapping
DB connection failed
Updated host and port
14. Validation & Testing
	‚Ä¢	Smoke tests
	‚Ä¢	DB connectivity validation
	‚Ä¢	Log verification
	‚Ä¢	Resource usage checks

‚∏ª

15. Lessons Learned & Best Practices
	‚Ä¢	Always externalize configs
	‚Ä¢	Use stdout logging
	‚Ä¢	Avoid host-specific assumptions
	‚Ä¢	Validate secrets early

‚∏ª

16. References
	‚Ä¢	OpenShift documentation
	‚Ä¢	Internal GitHub repo
	‚Ä¢	Migration guidelines

‚∏ª

3Ô∏è‚É£ Images / Diagrams to Add (Very Important)

Add only these 4 images ‚Äî don‚Äôt overdo it.

üñºÔ∏è Image 1: Architecture Diagram (Mandatory)

üìç Section: 4.2 Architecture Diagram

Use draw.io and show:
CronJob ‚Üí Pod ‚Üí DB
           ‚Üì
        Secrets (NGC)
Image 2: Pre vs Post Migration (Optional but powerful)

üìç Section: 3 vs 4

Split diagram:
	‚Ä¢	Left: On-prem server
	‚Ä¢	Right: OCP pod
Image 3: Resource Quotas Screenshot

üìç Section: 10 Monitoring & Logging

Use the screenshot you already have showing:
	‚Ä¢	CPU limits
	‚Ä¢	Memory limits
	‚Ä¢	Pods

This also supports the ‚Äú10 CPU ‚âà 60 cores‚Äù explanation
Image 4: Logs in OpenShift

üìç Section: 8 Runtime Behavior

Screenshot of:
oc logs <pod>



